/* eslint-disable @typescript-eslint/no-unused-vars */
// src/service/evm/script/debug_deposit.ts
import EVM from '..';
import { parsers } from '../opcodes/utils';
import { buildState, buildTxData } from '../utils';

const runtimeBytecode =
  '60806040526040518060400160405280600981526020017f4d656d65546f6b656e0000000000000000000000000000000000000000000000815250600090816200004a919062000415565b506040518060400160405280600481526020017f4d454d45000000000000000000000000000000000000000000000000000000008152506001908162000091919062000415565b506012600260006101000a81548160ff021916908360ff160217905550348015620000bb57600080fd5b5060405162001569380380620015698339818101604052810190620000e1919062000532565b80600460003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550806003819055503373ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040516200018c919062000575565b60405180910390a35062000592565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806200021d57607f821691505b602082108103620002335762000232620001d5565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026200029d7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826200025e565b620002a986836200025e565b95508019841693508086168417925050509392505050565b6000819050919050565b6000819050919050565b6000620002f6620002f0620002ea84620002c1565b620002cb565b620002c1565b9050919050565b6000819050919050565b6200031283620002d5565b6200032a6200032182620002fd565b8484546200026b565b825550505050565b600090565b6200034162000332565b6200034e81848462000307565b505050565b5b8181101562000376576200036a60008262000337565b60018101905062000354565b5050565b601f821115620003c5576200038f8162000239565b6200039a846200024e565b81016020851015620003aa578190505b620003c2620003b9856200024e565b83018262000353565b50505b505050565b600082821c905092915050565b6000620003ea60001984600802620003ca565b1980831691505092915050565b6000620004058383620003d7565b9150826002028217905092915050565b62000420826200019b565b67ffffffffffffffff8111156200043c576200043b620001a6565b5b62000448825462000204565b620004558282856200037a565b600060209050601f8311600181146200048d576000841562000478578287015190505b620004848582620003f7565b865550620004f4565b601f1984166200049d8662000239565b60005b82811015620004c757848901518255600182019150602085019450602081019050620004a0565b86831015620004e75784890151620004e3601f891682620003d7565b8355505b6001600288020188555050505b505050505050565b600080fd5b6200050c81620002c1565b81146200051857600080fd5b50565b6000815190506200052c8162000501565b92915050565b6000602082840312156200054b576200054a620004fc565b5b60006200055b848285016200051b565b91505092915050565b6200056f81620002c1565b82525050565b60006020820190506200058c600083018462000564565b92915050565b610fc780620005a26000396000f3fe6080604052600436106100915760003560e01c806370a082311161005957806370a082311461019157806395d89b41146101ce578063a9059cbb146101f9578063d0e30db014610236578063dd62ed3e1461024057610091565b806306fdde0314610096578063095ea7b3146100c157806318160ddd146100fe57806323b872dd14610129578063313ce56714610166575b600080fd5b3480156100a257600080fd5b506100ab61027d565b6040516100b89190610b04565b60405180910390f35b3480156100cd57600080fd5b506100e860048036038101906100e39190610bbf565b61030b565b6040516100f59190610c1a565b60405180910390f35b34801561010a57600080fd5b506101136103fd565b6040516101209190610c44565b60405180910390f35b34801561013557600080fd5b50610150600480360381019061014b9190610c5f565b610403565b60405161015d9190610c1a565b60405180910390f35b34801561017257600080fd5b5061017b6106f5565b6040516101889190610cce565b60405180910390f35b34801561019d57600080fd5b506101b860048036038101906101b39190610ce9565b610708565b6040516101c59190610c44565b60405180910390f35b3480156101da57600080fd5b506101e3610720565b6040516101f09190610b04565b60405180910390f35b34801561020557600080fd5b50610220600480360381019061021b9190610bbf565b6107ae565b60405161022d9190610c1a565b60405180910390f35b61023e61094d565b005b34801561024c57600080fd5b5061026760048036038101906102629190610d16565b610a4f565b6040516102749190610c44565b60405180910390f35b6000805461028a90610d85565b80601f01602080910402602001604051908101604052809291908181526020018280546102b690610d85565b80156103035780601f106102d857610100808354040283529160200191610303565b820191906000526020600020905b8154815290600101906020018083116102e657829003601f168201915b505050505081565b600081600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925846040516103eb9190610c44565b60405180910390a36001905092915050565b60035481565b600081600460008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015610487576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161047e90610e02565b60405180910390fd5b81600560008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015610546576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161053d90610e6e565b60405180910390fd5b81600560008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546105d29190610ebd565b9250508190555081600460008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546106289190610ebd565b9250508190555081600460008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825461067e9190610ef1565b925050819055508273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040516106e29190610c44565b60405180910390a3600190509392505050565b600260009054906101000a900460ff1681565b60046020528060005260406000206000915090505481565b6001805461072d90610d85565b80601f016020809104026020016040519081016040528092919081815260200182805461075990610d85565b80156107a65780601f1061077b576101008083540402835291602001916107a6565b820191906000526020600020905b81548152906001019060200180831161078957829003601f168201915b505050505081565b600081600460003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015610832576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161082990610e02565b60405180910390fd5b81600460003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546108819190610ebd565b9250508190555081600460008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546108d79190610ef1565b925050819055508273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef8460405161093b9190610c44565b60405180910390a36001905092915050565b60003411610990576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161098790610f71565b60405180910390fd5b34600460003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546109df9190610ef1565b9250508190555034600360008282546109f89190610ef1565b925050819055503373ffffffffffffffffffffffffffffffffffffffff167fe1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109c34604051610a459190610c44565b60405180910390a2565b6005602052816000526040600020602052806000526040600020600091509150505481565b600081519050919050565b600082825260208201905092915050565b60005b83811015610aae578082015181840152602081019050610a93565b60008484015250505050565b6000601f19601f8301169050919050565b6000610ad682610a74565b610ae08185610a7f565b9350610af0818560208601610a90565b610af981610aba565b840191505092915050565b60006020820190508181036000830152610b1e8184610acb565b905092915050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000610b5682610b2b565b9050919050565b610b6681610b4b565b8114610b7157600080fd5b50565b600081359050610b8381610b5d565b92915050565b6000819050919050565b610b9c81610b89565b8114610ba757600080fd5b50565b600081359050610bb981610b93565b92915050565b60008060408385031215610bd657610bd5610b26565b5b6000610be485828601610b74565b9250506020610bf585828601610baa565b9150509250929050565b60008115159050919050565b610c1481610bff565b82525050565b6000602082019050610c2f6000830184610c0b565b92915050565b610c3e81610b89565b82525050565b6000602082019050610c596000830184610c35565b92915050565b600080600060608486031215610c7857610c77610b26565b5b6000610c8686828701610b74565b9350506020610c9786828701610b74565b9250506040610ca886828701610baa565b9150509250925092565b600060ff82169050919050565b610cc881610cb2565b82525050565b6000602082019050610ce36000830184610cbf565b92915050565b600060208284031215610cff57610cfe610b26565b5b6000610d0d84828501610b74565b91505092915050565b60008060408385031215610d2d57610d2c610b26565b5b6000610d3b85828601610b74565b9250506020610d4c85828601610b74565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680610d9d57607f821691505b602082108103610db057610daf610d56565b5b50919050565b7f4e6f7420656e6f7567682062616c616e63650000000000000000000000000000600082015250565b6000610dec601283610a7f565b9150610df782610db6565b602082019050919050565b60006020820190508181036000830152610e1b81610ddf565b9050919050565b7f4e6f7420617070726f7665640000000000000000000000000000000000000000600082015250565b6000610e58600c83610a7f565b9150610e6382610e22565b602082019050919050565b60006020820190508181036000830152610e8781610e4b565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000610ec882610b89565b9150610ed383610b89565b9250828203905081811115610eeb57610eea610e8e565b5b92915050565b6000610efc82610b89565b9150610f0783610b89565b9250828201905080821115610f1f57610f1e610e8e565b5b92915050565b7f4e6f204554482073656e74000000000000000000000000000000000000000000600082015250565b6000610f5b600b83610a7f565b9150610f6682610f25565b602082019050919050565b60006020820190508181036000830152610f8a81610f4e565b905091905056fea264697066735822122052e0e071cb7c21ddf8bd27629f53b71067e9df03d0b2d4e7a29d45db3382b43564736f6c63430008120033';

const evm = new EVM({
  debug: true, // Enable debug to see what's happening
  // saveLogs: false,
});

const requireTest = '34600011600c5760006000fd5b00';

// Test deposit function with debug enabled
console.log('Testing deposit function with debug...');

const result = await evm.start({
  _codeString: runtimeBytecode,
  _code: parsers.hexStringToUint8Array(runtimeBytecode),
  _txData: buildTxData({
    tx: {
      from: '0x1234567890123456789012345678901234567890',
      to: '0xabcdefabcdefabcdefabcdefabcdefabcdef123456', // Contract address
      data: 'd0e30db0', // deposit() function selector
      value: BigInt(1000000000000000000), // 1 ETH
    },
    name: '',
    code: { asm: '', bin: '' },
    expect: {},
  }),
  _globalState: buildState({
    ///
    state: {
      // Make sure sender has enough balance
      '0x1234567890123456789012345678901234567890': {
        balance: BigInt(5000000000000000000), // 5 ETH
        code: { asm: '', bin: '' },
      },
      // Contract initial state
      '0xabcdefabcdefabcdefabcdefabcdefabcdef123456': {
        balance: BigInt(0),
        code: { asm: '', bin: runtimeBytecode },
      },
    },
    name: '',
    code: { asm: '', bin: '' },
    expect: {},
  }),
});

console.log('Debug result:', JSON.stringify(result.logs));
